location.hostname==="imgur.com"&&function(a){var b=function(b){function c(){setTimeout(function(b){var c=a(b).data("imgur-id"),e=atob(d(b));p.file(c+h.filetype,e,{base64:!1,binary:!0}),console.log(g("Succesful: %1, %2kB",c,(e.length/1024).toFixed(2))),f()},h.timeout,this)}function d(a){var b=document.createElement("canvas");b.width=a.width,b.height=a.height;var c=b.getContext("2d");c.drawImage(a,0,0);var d=b.toDataURL(i,.95);return d.replace(/^data:image\/(png|jpg|jpeg);base64,/,"")}function e(){setTimeout(function(b){var c=a(b).data("imgur-id");n=a(n).not([c]).get(),o.push(c),console.log("Failed: "+c);var d={};(d=a("#IZAerrors")).length===0&&a(window.body).append(a(l)),d.append(g('<li><a href="http://imgur.com/download/%1">%1</a></li>',c)),a(g("[id$=%1] img, img[id$=%1]",c)).css("outline","3px solid red"),f()},h.timeout,this)}function f(){var a=Object.keys(p.files).length;q.html(g(j,a,n.length)),a===n.length&&(console.log("Generating zip..."),q.html("Generating zip..."),q=q.closest(".panel"),q.downloadify({filename:m+".zip",data:p.generate(),dataType:"base64",onError:function(){alert("An error occurred, sorry!")},onComplete:function(){q.remove(),q=undefined,window.onbeforeunload=function(){}},swf:h.baseurl+"media/downloadify.swf",downloadImage:h.baseurl+"media/download.png",width:84,height:25,transparent:!0}))}function g(a){for(var b=1,c=arguments.length;b<c;b++)a=a.replace("%"+b,arguments[b]);return a}b||(b={});var h={baseurl:"http://spencerhakim.github.com/ImgurZipAlbum/",filetype:".jpg",timeout:50};h=a.extend(h,b);var i=h.filetype===".jpg"?"image/jpeg":"image/png",j='<span class="stat">%1</span> of <span class="stat">%2</span> images downloaded...',k='<div class="panel" style="display:inline-block; position:fixed; bottom:0; padding:10px; z-index:+1001"><div class="textbox"><img src="'+h.baseurl+'media/loader.gif" style="vertical-align:text-bottom" /> <span id="IZAstatus"></span>'+"</div>"+"</div>",l='<div class="panel" style="display:inline-block; position:fixed; bottom:0; right:0; padding:10px; z-index:+1001"><div class="textbox"><span style="font-weight:bold; color:red">Failed images</span><ul id="IZAerrors" style="list-style-position:inside"></ul></div></div>',m=function(){var b=a("div[id^=album-].nodisplay").attr("id").split("-")[1],c=a("div[id^=album-].nodisplay").data("title");return g("%1%2",b,c.length>0?" - "+c:"")}(),n=a(".jcarousel ul li img").map(function(){return this.id.split("-")[1]}).get(),o=[],p=new JSZip;console.log("Album name = "+m),console.log("Image IDs  = "+n);if(n.length===0){alert("This album appears to be empty...");return}a(window.body).append(a(k));var q=a("#IZAstatus");q.html(g(j,0,n.length)),window.onbeforeunload=function(){return};for(var r=0,s=n.length;r<s;r++)a("<img />").load(c).error(e).data("imgur-id",n[r]).attr("src","http://imgur.com/download/"+n[r])};if(a("div[id^=album-].nodisplay").length===0){alert("Hey, this isn't an album!");return}a.ajaxSetup({cache:!0});if(!window.atob||!window.btoa)a.ajax({url:"http://stringencoders.googlecode.com/svn/trunk/javascript/base64.js",async:!1,dataType:"script"}),window.atob||(window.btoa=base64.encode),window.atob||(window.atob=base64.decode);a.getScript("http://spencerhakim.github.com/ImgurZipAlbum/js/jszip.js",function(){a.getScript("http://spencerhakim.github.com/ImgurZipAlbum/js/swfobject.js",function(){a.getScript("http://spencerhakim.github.com/ImgurZipAlbum/js/downloadify.min.js",function(){b()})})})}(jQuery);
location.hostname==="imgur.com"&&function(a){function c(a,b,c){alert("Failed to load: "+b.url)}var b=function(b){function h(){setTimeout(function(c){var d=a(c).data("imgur-id"),e=atob(i(c));p.file(d+b,e,{base64:!1,binary:!0}),console.log(l("Succesful: %1, %2kB",d,(e.length/1024).toFixed(2))),k()},c.timeout,this)}function i(a){var b=document.createElement("canvas");b.width=a.width,b.height=a.height;var c=b.getContext("2d");c.drawImage(a,0,0);var e=b.toDataURL(d,.95);return e.replace(/^data:image\/(png|jpg|jpeg);base64,/,"")}function j(){setTimeout(function(b){var c=a(b).data("imgur-id");n=a(n).not([c]).get(),o.push(c),console.log("Failed: "+c);var d={};(d=a("#IZAerrors")).length===0&&a(window.body).append(a(g)),d.append(l('<li><a href="http://imgur.com/download/%1">%1</a></li>',c)),a(l("[id$=%1] img, img[id$=%1]",c)).css("outline","3px solid red"),k()},c.timeout,this)}function k(){var a=Object.keys(p.files).length;q.html(l(e,a,n.length)),a===n.length&&(console.log("Generating zip..."),q.html("Generating zip..."),q=q.closest(".panel"),q.downloadify({filename:m+".zip",data:p.generate(),dataType:"base64",onError:function(){alert("An error occurred, sorry!")},onComplete:function(){q.remove(),q=undefined,window.onbeforeunload=function(){}},swf:c.baseurl+"media/downloadify.swf",downloadImage:c.baseurl+"media/download.png",width:84,height:25,transparent:!0}))}function l(a){for(var b=1,c=arguments.length;b<c;b++)a=a.replace("%"+b,arguments[b]);return a}b||(b={});var c={baseurl:"http://spencerhakim.github.com/ImgurZipAlbum/",filetype:".jpg",timeout:50};c=a.extend(c,b);var d=c.filetype===".jpg"?"image/jpeg":"image/png",e='<span class="stat">%1</span> of <span class="stat">%2</span> images downloaded...',f='<div class="panel" style="display:inline-block; position:fixed; bottom:0; padding:10px; z-index:+1001"><div class="textbox"><img src="'+c.baseurl+'media/loader.gif" style="vertical-align:text-bottom" /> <span id="IZAstatus"></span>'+"</div>"+"</div>",g='<div class="panel" style="display:inline-block; position:fixed; bottom:0; right:0; padding:10px; z-index:+1001"><div class="textbox"><span style="font-weight:bold; color:red">Failed images</span><ul id="IZAerrors" style="list-style-position:inside"></ul></div></div>',m=a("div[id^=album-].nodisplay").attr("id").split("-")[1]+" - "+a("div[id^=album-].nodisplay").data("title"),n=a(".jcarousel ul li img").map(function(){return this.id.split("-")[1]}).get(),o=[],p=new JSZip;console.log("Album name = "+m),console.log("Image IDs  = "+n);if(n.length===0){alert("This album appears to be empty...");return}a(window.body).append(a(f));var q=a("#IZAstatus");q.html(l(e,0,n.length)),window.onbeforeunload=function(){return};for(var r in n){if(!n.hasOwnProperty(r))continue;a("<img />").load(h).error(j).data("imgur-id",n[r]).attr("src","http://imgur.com/download/"+n[r])}};if(a("div[id^=album-].nodisplay").length===0){alert("Hey, this isn't an album!");return}a.ajaxSetup({cache:!0}),a.getScript("http://spencerhakim.github.com/ImgurZipAlbum/js/jszip.js",function(){a.getScript("http://spencerhakim.github.com/ImgurZipAlbum/js/swfobject.js",function(){a.getScript("http://spencerhakim.github.com/ImgurZipAlbum/js/downloadify.min.js",function(){b()}).fail(c)}).fail(c)}).fail(c)}(jQuery);